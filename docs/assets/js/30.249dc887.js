(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{413:function(s,t,a){"use strict";a.r(t);var e=a(42),r=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"使用docker搭建mysql服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用docker搭建mysql服务"}},[s._v("#")]),s._v(" 使用Docker搭建MySQL服务")]),s._v(" "),a("h3",{attrs:{id:"一、安装docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、安装docker"}},[s._v("#")]),s._v(" 一、安装docker")]),s._v(" "),a("p",[s._v("windows 和 mac 版可以直接到官网下载 docker desktop")]),s._v(" "),a("p",[s._v("linux 的安装方法可以参考 https://www.cnblogs.com/myzony/p/9071210.html")]),s._v(" "),a("p",[s._v("可以在shell中输入以下命令检查是否成功安装： "),a("code",[s._v("sudo docker version")])]),s._v(" "),a("h3",{attrs:{id:"二、建立镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、建立镜像"}},[s._v("#")]),s._v(" 二、建立镜像")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("拉取官方镜像（我们这里选择5.7，如果不写后面的版本号则会自动拉取最新版）")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("docker pull mysql:5.7   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拉取 mysql 5.7")]),s._v("\ndocker pull mysql       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拉取最新版mysql镜像")]),s._v("\n")])])]),a("p",[a("a",{attrs:{href:"https://hub.docker.com/_/mysql/",target:"_blank",rel:"noopener noreferrer"}},[s._v("MySQL文档地址"),a("OutboundLink")],1)])]),s._v(" "),a("li",[a("p",[s._v("检查是否拉取成功")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ sudo docker images\n")])])])]),s._v(" "),a("li",[a("p",[s._v("一般来说数据库容器不需要建立目录映射")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker run -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v(":3306 --name mysql -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_ROOT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" -d mysql:5.7\n")])])]),a("ul",[a("li",[s._v("–name：容器名，此处命名为"),a("code",[s._v("mysql")])]),s._v(" "),a("li",[s._v("-e：配置信息，此处配置mysql的root用户的登陆密码")]),s._v(" "),a("li",[s._v("-p：端口映射，此处映射 主机3306端口 到 容器的3306端口")]),s._v(" "),a("li",[s._v("-d：后台运行容器，保证在退出终端后容器继续运行")])])]),s._v(" "),a("li",[a("p",[s._v("如果要建立目录映射")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("duso docker run -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v(":3306 --name mysql "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-v /usr/local/docker/mysql/conf:/etc/mysql "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-v /usr/local/docker/mysql/logs:/var/log/mysql "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-v /usr/local/docker/mysql/data:/var/lib/mysql "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_ROOT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-d mysql:5.7\n")])])]),a("ul",[a("li",[s._v('-v：主机和容器的目录映射关系，":"前为主机目录，之后为容器目录')])])]),s._v(" "),a("li",[a("p",[s._v("检查容器是否正确运行")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("docker container "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n")])])]),a("ul",[a("li",[s._v("可以看到容器ID，容器的源镜像，启动命令，创建时间，状态，端口映射信息，容器名字")])])])]),s._v(" "),a("h3",{attrs:{id:"三、连接mysql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、连接mysql"}},[s._v("#")]),s._v(" 三、连接mysql")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("进入docker本地连接mysql客户端")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it mysql "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\nmysql -uroot -p123456\n")])])])]),s._v(" "),a("li",[a("p",[s._v("使用远程连接软件时要注意一个问题")]),s._v(" "),a("p",[s._v("我们在创建容器的时候已经将容器的3306端口和主机的3306端口映射到一起，所以我们应该访问：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("host: 127.0.0.1\nport: 3306\nuser: root\npassword: 123456\n")])])])]),s._v(" "),a("li",[a("p",[s._v("如果你的容器运行正常，但是无法访问到MySQL，一般有以下几个可能的原因：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("防火墙阻拦")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开放端口：")]),s._v("\n$ systemctl status firewalld\n$ firewall-cmd  --zone"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("public --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("/tcp -permanent\n$ firewall-cmd  --reload\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭防火墙：")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl stop firewalld\n")])])])]),s._v(" "),a("li",[a("p",[s._v("需要进入docker本地客户端设置远程访问账号")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it mysql "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n$ mysql -uroot -p123456\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" grant all privileges on *.* to root@"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%'")]),s._v(" identified by "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"password"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("原理：")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql使用mysql数据库中的user表来管理权限，修改user表就可以修改权限（只有root账号可以修改）")]),s._v("\n\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" use mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nDatabase changed\n\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" host,user,password from user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n+--------------+------+-------------------------------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("                    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" user      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" password                                                                 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------+------+-------------------------------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" localhost              "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" *A731AEBFB621E354CD41BAF207D884A609E81F5E      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.1            "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" *A731AEBFB621E354CD41BAF207D884A609E81F5E      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------+------+-------------------------------------------+\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" rows "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" grant all privileges  on *.* to root@"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%'")]),s._v(" identified by "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"password"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery OK, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" rows affected "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" flush privileges"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery OK, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" rows affected "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" host,user,password from user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n+--------------+------+-------------------------------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("                    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" user      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" password                                                                 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------+------+-------------------------------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" localhost              "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" *A731AEBFB621E354CD41BAF207D884A609E81F5E     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.1            "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" *A731AEBFB621E354CD41BAF207D884A609E81F5E     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" %                       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" *A731AEBFB621E354CD41BAF207D884A609E81F5E     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------+------+-------------------------------------------+\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" rows "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])])])])])]),s._v(" "),a("p",[s._v("最后，我们可以使用SQLyog测试mysql连接")])])}),[],!1,null,null,null);t.default=r.exports}}]);